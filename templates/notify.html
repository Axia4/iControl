{% extends "_base.html" %}

{% block title %}Enviar aviso - iControl{% endblock %}

{% block content %}
<!--
Fields: targets, message, button_title, button_url, priority(-2=5)
The targets are a list of device names or "*"
The targets should be selected from a right half of the page as a list of checkboxes or a text input with comma-separated values.
The message is a textarea.
The button_title and button_url are optional.
The priority is an integer from -2 to 5, where -2 is the lowest and 5 the highest.
The form should submit to /notify with POST method.
Example data:
{
    "targets": ["device1", "device2"],
    "message": "This is a test message",
    "button_title": "View",
    "button_url": "https://example.com",
    "priority": 3
}
-->
<form method="POST" action="/notify">
    <div data-bs-theme="light" class="jumbotron bg-light text-dark p-5 rounded mb-3">
        <h1 class="display-4">Enviar aviso</h1>
        <p class="lead">Aquí puedes enviar un aviso a los dispositivos activados.</p>
        <hr class="my-4">
        <div class="mb-3">
            <label for="message" class="form-label">Mensaje</label>
            <textarea class="form-control" id="message" name="message" rows="3" required></textarea>
        </div>
        <div class="mb-3">
            <label for="button_title" class="form-label">Título del botón (opcional)</label>
            <input type="text" class="form-control" id="button_title" name="button_title" placeholder="Ver">
        </div>
        <div class="mb-3">
            <label for="button_url" class="form-label">URL del botón (opcional)</label>
            <input type="url" class="form-control" id="button_url" name="button_url" placeholder="https://example.com">
        </div>
        <div class="mb-3">
            <label for="priority" class="form-label">Prioridad</label>
            <!-- 4 color Orange, 5 color #ff0000-->
            <select class="form-select mt-2" id="priority" name="priority" required style="color: black" onchange="var color = ''; var text = ''; switch(this.value) {case '2': color = '#00ff00'; text = 'black'; break;case '1': color = '#0000ff'; text = 'white'; break;case '3': color = '#ffffff'; text = 'black'; break;case '4': color = '#ffa500'; text = 'white'; break; case '5': color = '#ff0000'; text = 'white'; break; default: color = '#ffffff'; text = 'unset'; } this.style.backgroundColor = color; this.style.color = text;">
                <option value="1">Solo PCs (1)</option>
                <option value="2">Baja (2)</option>
                <option value="3" selected>Normal (3)</option>
                <option value="4">Prioritaria (4)</option>
                <option value="5">Urgente (5)</option>
            </select>
        </div>
    </div>
    <div data-bs-theme="light" class="jumbotron bg-light text-dark p-5 rounded mb-3">
        <h1>Dispositivos</h1>
        <p class="lead">Lista de dispositivos registrados:</p>
        <hr class="my-4">
        <button type="button" class="btn btn-info mb-3" onclick="var checkboxes = document.querySelectorAll('input[name=\'targets\']'); checkboxes.forEach(cb => cb.checked = !cb.checked);">Invertir selección</button>
        <button type="button" class="btn btn-info mb-3" onclick="var checkboxes = document.querySelectorAll('input[name=\'targets\']'); checkboxes.forEach(cb => cb.checked = true);">Seleccionar todos</button>
        <button type="button" class="btn btn-info mb-3" onclick="var checkboxes = document.querySelectorAll('input[name=\'targets\']'); checkboxes.forEach(cb => cb.checked = false);">Deseleccionar todos</button>
        <div class="grid gap-2" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
            {% for id, device in devices %}
                <div class="form-check" style="display: inline-block; border: 1px solid black; background-color: white; border-radius: 5px; padding: 10px; margin: 5px; padding-left: 30px;">
                    <input style="width: 20px; height: 20px;" class="form-check-input" type="checkbox" name="targets" value="{{ device.ntfy_topic }}" id="device_{{ id }}" onchange="if(this.checked) { this.parentElement.style.backgroundColor = '#22ff00'; } else { this.parentElement.style.backgroundColor = 'white'; }">
                    <label class="form-check-label" for="device_{{ id }}">{{ device.name }} - {{ device.description }}</label>
                </div>
            {% endfor %}
        </div>
    </div>
    <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Enviar aviso</button>
</form>
{% endblock %}